
<ng-container *ngIf="isOpen$ | async">
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-window" (click)="$event.stopPropagation()">
      <div class="modal-container">

        <!-- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ -->
        <ng-container *ngIf="isSuccess; else formTemplate">
          <div class="success-block">
            <h2 class="modal-title">–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É!</h2>
            <p class="modal-text">–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∂–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.</p>
            <button class="button" (click)="closeModal()">–û–∫–µ–π</button>
          </div>
        </ng-container>

        <!-- üßæ –§–æ—Ä–º–∞ -->
        <ng-template #formTemplate>
          <h2 class="modal-title">–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É</h2>
          <form [formGroup]="form" (ngSubmit)="onSubmit()" class="modal-form">
            <!-- üíõ –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ -->
            <div class="select-wrap" [class.invalid]="form.get('service')?.invalid && form.get('service')?.touched">
              <button
                type="button"
                class="select-control"
                (click)="toggleDropdown()"
                (keydown)="onKeydown($event)"
                [attr.aria-expanded]="dropdownOpen"
                aria-haspopup="listbox">
                <span>{{ form.value.service || '–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É' }}</span>
                <svg class="caret" viewBox="0 0 20 20" width="16" height="16" aria-hidden="true">
                  <path d="M5 7l5 6 5-6z"></path>
                </svg>
              </button>

              <div class="select-menu" *ngIf="dropdownOpen" role="listbox">
                <div
                  *ngFor="let s of services; let i = index"
                  class="option"
                  role="option"
                  [attr.aria-selected]="form.value.service === s"
                  [class.selected]="form.value.service === s"
                  (mouseenter)="focusedIndex = i"
                  (mousedown)="selectService(s)">
                  {{ s }}
                </div>
              </div>
            </div>

            <!-- –ò–º—è -->
            <input
              type="text"
              placeholder="–í–∞—à–µ –∏–º—è"
              formControlName="name"
              [class.invalid]="form.get('name')?.invalid && form.get('name')?.touched" />

            <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
            <input
              type="tel"
              placeholder="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω"
              formControlName="phone"
              [class.invalid]="form.get('phone')?.invalid && form.get('phone')?.touched" />

            <!-- üîí –ö–Ω–æ–ø–∫–∞ -->
            <button
              type="submit"
              class="submit-btn"
              [disabled]="form.invalid || loading">
              {{ loading ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å' }}
            </button>

            <!-- –û—à–∏–±–∫–∞ -->
            <div *ngIf="isError" class="error-message">
              –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.
            </div>
          </form>
        </ng-template>

      </div>
    </div>
  </div>
</ng-container>

